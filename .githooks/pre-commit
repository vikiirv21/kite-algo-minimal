#!/usr/bin/env bash
set -euo pipefail

PROJECT_ROOT="$(cd -- "$(dirname -- "$0")/.." && pwd)"
cd "$PROJECT_ROOT"

PYTHON_BIN=""
for candidate in python3 python py; do
    if command -v "$candidate" >/dev/null 2>&1; then
        PYTHON_BIN="$candidate"
        break
    fi
done

if [[ -z "$PYTHON_BIN" ]]; then
    echo "[docsync] Unable to find a Python interpreter (python3/python/py)." >&2
    exit 1
fi

echo "[docsync] Running documentation sync via $PYTHON_BIN ..."
if ! "$PYTHON_BIN" -m tools.docsync; then
    echo "[docsync] Documentation sync failed. Aborting commit." >&2
    exit 1
fi

if ! git diff --quiet -- docs CHANGELOG.md; then
    echo "[docsync] Detected documentation changes. Staging docs/ and CHANGELOG.md."
    git add docs CHANGELOG.md
fi

exit 0
