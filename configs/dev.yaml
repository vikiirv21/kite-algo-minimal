ENABLE_LIVE_QUOTES_IN_APP: true

session:
  market_open_ist: "09:15"
  market_close_ist: "15:30"

trading:
  mode: "paper"            # "paper" or "live"

  # Logical FnO universe. Code resolves these into current NFO FUT contracts.
  fno_universe:
    - "NIFTY"
    - "BANKNIFTY"
    - "FINNIFTY"

  # Logical underlyings for index options trading (options engine).
  options_underlyings:
    - "NIFTY"
    - "BANKNIFTY"
    - "FINNIFTY"

  equity_universe: []      # Managed via config/universe_equity.csv

  default_product: "MIS"
  default_quantity: 1       # units per order (strategy can override)

  # Risk and capital model for PAPER mode
  paper_capital: 500000         # starting capital used for paper equity calculation
  max_daily_loss: 3000          # stop trading when realized PnL <= -max_daily_loss
  per_symbol_max_loss: 1500     # stop trading a specific symbol when realized PnL(symbol) <= -per_symbol_max_loss
  max_loss_pct_per_trade: 0.01  # per-trade max loss (1% = 0.01) on entry price
  max_notional_multiplier: 1.0  # max total notional as multiple of paper_capital

  max_open_positions: 5

data:
  source: "broker"          # for now, always "broker" (Kite). Later: "nse", "cached".
  timeframe: "5minute"      # base timeframe for intraday decisions
  history_lookback: 50      # number of candles for indicators
  
  # Market Data Engine v2 Configuration
  use_mde_v2: false         # Enable Market Data Engine v2 (set to true to activate)
  feed: "kite"              # Data feed mode: "kite" (live) or "replay" (historical/backtest)
  timeframes:               # Active timeframes for candle building
    - "1m"
    - "5m"
  symbols: []               # Specific symbols for MDE v2 (empty = use universe)
  replay_speed: 1.0         # Replay speed multiplier (1.0 = real-time, 10.0 = 10x faster)

strategy_engine:
  version: 1                # 1 = legacy StrategyRunner, 2 = StrategyEngineV2
  # When version: 2, specify v2 strategies to enable:
  strategies_v2:
    # - ema20_50_intraday_v2
  # Additional config for v2 engine
  window_size: 200          # Historical candle window for indicators
  use_unified_indicators: true

logging:
  level: "INFO"
  directory: "logs"
  file_prefix: "kite_algo"

kite:
  preflight_check: true

meta:
  enabled: true
  symbols_focus:
    - "BANKNIFTY"
    - "NIFTY"
    - "FINNIFTY"
  allow_equity_satellites: true
  max_active_symbols: 5
  cost_per_trade_pct: 0.0005
  fallback_intraday_when_no_decision: true
  decision_cache_ttl_sec: 120

risk:
  enable_cost_model: false
  enable_trade_quality_filter: false
  default_raw_edge_bps: 20.0
  cost:
    brokerage_per_order: 20.0
    turnover_pct: 0.0003
    stt_pct: 0.00025
    gst_pct: 0.18
    stamp_duty_pct: 0.00003
    other_pct: 0.0
  quality:
    min_edge_after_costs_bps: 10.0
    max_trades_per_symbol_per_day: 5
    cooldown_after_loss_trades: 2
  atr:
    enabled: true
    lookback: 14
    sl_r_multiple: 1.0
    tp_r_multiple: 2.0
    hard_sl_pct_cap: 0.03
    hard_tp_pct_cap: 0.06
    min_atr_value: 0.5
    per_product:
      OPT:
        sl_r_multiple: 1.2
        tp_r_multiple: 2.2
      FUT:
        sl_r_multiple: 1.0
        tp_r_multiple: 2.0
  time_filter:
    enabled: true
    allow_sessions:
      - { start: "09:20", end: "11:30" }
      - { start: "13:15", end: "15:10" }
    block_expiry_scalps_after: "15:00"
    min_time: "09:20"
    max_time: "15:20"

risk_engine:
  enabled: false
  max_loss_per_trade_pct: 0.01    # 1% default hard guard
  soft_stop_pct: -0.7            # percent PnL, partial exit trigger
  hard_stop_pct: -1.2            # percent PnL, force exit
  take_profit_r: 2.0
  trail_start_r: 1.0
  trail_step_r: 0.5
  time_stop_bars: 25
  partial_exit_fraction: 0.5
  enable_partial_exits: true
  enable_trailing: true
  enable_time_stop: true

learning_engine:
  enabled: false
  lookback_days: 5
  tuning_path: "artifacts/learning/strategy_tuning.json"
  min_risk_multiplier: 0.25
  max_risk_multiplier: 2.0

execution:
  # ExecutionEngine v2 configuration
  use_execution_engine_v2: false  # Set to true to enable ExecutionEngine v2
  dry_run: false  # When true, simulates live orders without actual placement
  slippage_bps: 5.0  # Slippage in basis points for paper fills (5 bps = 0.05%)
  use_bid_ask_spread: false  # Use bid-ask spread for more realistic paper fills
  
  circuit_breakers:
    max_daily_loss_rupees: 5000.0  # Stop trading when daily loss exceeds this
    max_daily_drawdown_pct: 0.02  # Stop trading when drawdown exceeds 2%
    max_trades_per_day: 100  # Maximum trades per day
    max_trades_per_strategy_per_day: 50  # Maximum trades per strategy per day
    max_loss_streak: 5  # Stop trading after N consecutive losses

portfolio:
  # Portfolio & Position Sizing Engine v1 Configuration
  max_leverage: 2.0               # Maximum leverage (2x = can use 2x equity as exposure)
  max_exposure_pct: 0.8           # Max 80% of equity in open positions
  max_risk_per_trade_pct: 0.01    # Risk 1% of equity per trade
  max_risk_per_strategy_pct: 0.2  # Max 20% of equity risk per strategy (fallback)
  position_sizing_mode: "fixed_qty"  # "fixed_qty" or "fixed_risk_atr"
  lot_size_fallback: 25           # Default lot size for FnO when not available
  default_fixed_qty: 1            # Default quantity when mode is fixed_qty
  atr_stop_multiplier: 2.0        # For ATR mode: stop distance = k * ATR
  
  # Per-strategy capital budgets
  strategy_budgets:
    ema20_50_intraday:
      capital_pct: 0.3            # 30% of equity for this strategy
      fixed_qty: 1                # Optional: override default_fixed_qty for this strategy
    expiry_scalper:
      capital_pct: 0.4            # 40% of equity for this strategy
